"use strict";(self.webpackChunkmrvym_blog=self.webpackChunkmrvym_blog||[]).push([[1140],{4302:e=>{e.exports=JSON.parse('{"permalink":"/how-copy-paste-works-on-linux","editUrl":"https://github.com/MrVyM/MrVyM.github.io/issues/blog/2025-01-31-How-copy-paste-works.mdx","source":"@site/blog/2025-01-31-How-copy-paste-works.mdx","title":"How copy-paste works on Linux ?","description":"In this article, we will explore the internal workings of copy and paste in Linux.","date":"2025-04-04T00:00:00.000Z","tags":[{"inline":true,"label":"Linux","permalink":"/tags/linux"},{"inline":true,"label":"Xorg","permalink":"/tags/xorg"},{"inline":true,"label":"Copy","permalink":"/tags/copy"},{"inline":true,"label":"Paste","permalink":"/tags/paste"}],"readingTime":2.4266666666666663,"hasTruncateMarker":true,"authors":[{"name":"Vianney Marticou","title":"Mr.VyM @ EPITA","url":"https://github.com/mrvym","page":{"permalink":"/authors/mrvym"},"socials":{"github":"https://github.com/mrvym","linkedin":"https://www.linkedin.com/in/vianney-marticou/"},"imageURL":"https://github.com/mrvym.png","key":"mrvym"}],"frontMatter":{"slug":"how-copy-paste-works-on-linux","title":"How copy-paste works on Linux ?","tags":["Linux","Xorg","Copy","Paste"],"date":"2025-04-04T00:00:00.000Z","authors":["mrvym"]},"unlisted":false,"prevItem":{"title":"D\xe9sactiver les pinsyscalls sur OpenBSD","permalink":"/pinsyscall-on-openbsd"},"nextItem":{"title":"Le plus petit segfault","permalink":"/le-plus-petit-segfault"}}')},8453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>a});var n=s(6540);const i={},o=n.createContext(i);function r(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(o.Provider,{value:t},e.children)}},9028:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>n,toc:()=>c});var n=s(4302),i=s(4848),o=s(8453);const r={slug:"how-copy-paste-works-on-linux",title:"How copy-paste works on Linux ?",tags:["Linux","Xorg","Copy","Paste"],date:new Date("2025-04-04T00:00:00.000Z"),authors:["mrvym"]},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"First some history",id:"first-some-history",level:2},{value:"X vs X.org vs X11",id:"x-vs-xorg-vs-x11",level:3},{value:"X10 and cut-buffers",id:"x10-and-cut-buffers",level:2},{value:"X11 support",id:"x11-support",level:2},{value:"PRIMARY",id:"primary",level:4},{value:"CLIPBOARD",id:"clipboard",level:4},{value:"SECONDARY",id:"secondary",level:4},{value:"XDND",id:"xdnd",level:2},{value:"Alias",id:"alias",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"In this article, we will explore the internal workings of copy and paste in Linux.\nFirst, let me provide some context. There is a manual, almost like an RFC."}),"\n",(0,i.jsx)(t.p,{children:"The Inter-Communication Client Conventions Manual (ICCCM for short), which lays down some rules.\nThe first version was published in July 1989, the second in 1994.\nThis manual, written 30 years ago, is therefore the reference for the subject."}),"\n",(0,i.jsx)(t.h2,{id:"first-some-history",children:"First some history"}),"\n",(0,i.jsx)(t.h3,{id:"x-vs-xorg-vs-x11",children:"X vs X.org vs X11"}),"\n",(0,i.jsx)(t.p,{children:"The X Window System, also known as X, is old. Written in 1984, it was the default windowing system for most Unix systems.\nBut X is not the implementation, it is more a set of protocols and architecture."}),"\n",(0,i.jsx)(t.p,{children:"X.org is the free and open source implementation of the X Window System. X.org is also a foundation that oversees the development of X11."}),"\n",(0,i.jsx)(t.p,{children:"X11 is the latest version (since 1987) of the X architecture, and X10 is the first iteration of the project born with X in 1984."}),"\n",(0,i.jsx)(t.h2,{id:"x10-and-cut-buffers",children:"X10 and cut-buffers"}),"\n",(0,i.jsxs)(t.p,{children:["For context, the first release of X10 was in 1985. At that time, the ICCCM hadn't been released.\nXorg was doing its own thing. They used a thing called ",(0,i.jsx)(t.code,{children:"cut-buffer' or also known as "}),"buffer-cut'."]}),"\n",(0,i.jsx)(t.p,{children:"A cut-buffer works like a circular buffer of 8 buffers, ranging from CUTBUFFER0 to CUTBUFFER7.\nWhen a user tries to add a string to a cut buffer, each string is swapped to a different buffer.\nSo the circular buffer is like a history of all copy-paste."}),"\n",(0,i.jsx)(t.p,{children:"Nowadays, there are no more programs that use a cut-buffer, or at least they used the cut-buffer and the new method."}),"\n",(0,i.jsx)(t.h2,{id:"x11-support",children:"X11 support"}),"\n",(0,i.jsxs)(t.p,{children:["X has an object called 'selections'. It is basically a clipboard, but for a different use.\nThere are THREE selections defined by ICCCM: Primary, Secondary, and Clipboard The ICCCM also makes a distinction between ",(0,i.jsx)(t.code,{children:"Passive"})," and ",(0,i.jsx)(t.code,{children:"Active"})," selections."]}),"\n",(0,i.jsx)(t.p,{children:"Passive"}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"When some data is selected, the client handling the window where this selection is done transfers it somewhere, and no longer needs to care about it"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Active"}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:'Transfer of data to a client requires the client "holding" the selection to actively participate in the exchange.'}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"primary",children:"PRIMARY"}),"\n",(0,i.jsx)(t.p,{children:'I is mostly used when you select some text with your mouse. You can use your mouse middle click to paste it.\nI said "mostly" because it depends on the software. Each X11 application decides which binding it uses to interact with a selection.'}),"\n",(0,i.jsx)(t.p,{children:"So, as you understand, it's a `passive' selection. The user does not ask the system to copy this text."}),"\n",(0,i.jsx)(t.h4,{id:"clipboard",children:"CLIPBOARD"}),"\n",(0,i.jsxs)(t.p,{children:["This is an ",(0,i.jsx)(t.code,{children:"active"})," selection. It's used when the user wants to copy some data. It can be done with either ",(0,i.jsx)(t.code,{children:"Ctrl-C"})," or the simpler ",(0,i.jsx)(t.code,{children:"Mouse right click + copy"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["In ",(0,i.jsx)(t.code,{children:"vim"})," you could copy something with ",(0,i.jsx)(t.code,{children:"*y"})," and ",(0,i.jsx)(t.code,{children:"*p"})," or"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"set clipboard=unnamedplus\n"})}),"\n",(0,i.jsxs)(t.p,{children:["So when the user requests ",(0,i.jsx)(t.code,{children:"Paste"}),", it will be the contents of the CLIPBOARD selection."]}),"\n",(0,i.jsx)(t.h4,{id:"secondary",children:"SECONDARY"}),"\n",(0,i.jsx)(t.p,{children:"To be honest, I looked for as much information as I could about this selection, but I couldn't find any application that used it for any good reason."}),"\n",(0,i.jsxs)(t.p,{children:["In ",(0,i.jsx)(t.code,{children:"vim"})," you could copy something in it with ",(0,i.jsx)(t.code,{children:"+y"})," and ",(0,i.jsx)(t.code,{children:"+p"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"set clipboard=unnamed\n"})}),"\n",(0,i.jsx)(t.h2,{id:"xdnd",children:"XDND"}),"\n",(0,i.jsxs)(t.p,{children:["Such a complex word, it's just the first letter of ",(0,i.jsx)(t.code,{children:"X Drag and Drop Protocol"}),". When I did some research on the clipboard, I found information about drag and drop."]}),"\n",(0,i.jsxs)(t.p,{children:["When a drag starts, the source takes ownership of ",(0,i.jsx)(t.code,{children:"XDNDSelection"})," (a structure inside X11), and when the mouse leaves the source, X11 sends a message to the target. At this point the user can release the mouse, the target gets a lot of information with a specific selection ",(0,i.jsx)(t.code,{children:"XA_PRIMARY"}),". XA stands for XDNDAware, the module responsible for DND in X. With all this information, the target software could easily request the resource from the source software.\nI learn that within the first iteration of X, there are no optimizations when `target = source'."]}),"\n",(0,i.jsx)(t.h2,{id:"alias",children:"Alias"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'alias paste="xclip -o"\n\nalias copy="xclip"\n'})}),"\n",(0,i.jsx)(t.p,{children:"And so you can use like this."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"cat LONG_FILE | copy \n\npaste | vim - \n"})}),"\n",(0,i.jsx)(t.p,{children:"Sources :"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://x.org/releases/X11R7.6/doc/xorg-docs/specs/ICCCM/icccm.html",children:"ICCCM"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"http://vimdoc.sourceforge.net/htmldoc/gui_x11.html#quoteplus",children:"VimDoc"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://www.freedesktop.org/wiki/Specifications/ClipboardsWiki/",children:"ClipbordWiki"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://superuser.com/questions/90257/what-is-the-difference-between-the-x-clipboards",children:"StackOverflow - Diff between X Clip"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://freedesktop.org/wiki/Specifications/XDND/",children:"XDND"})}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);